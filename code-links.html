---
layout: default
title: Code Links
---
<section>
    <h2> Code Links</h2>

    <p>This tool converts references in the code examples to links into GitHub.</p>

    <div id="converter">
        <label for="coderef">Example Number: </label>
        <input id="coderef"
               type="text"
               placeholder="Chapter#.Step#. For example: 4.2"
               oninput="generateLinks()"
               autofocus="autofocus"
               size="80"
               pattern="^[1-9][0-9]*\\.[1-9][0-9]*)$"
        />

        <nav class="results" style="visibility: hidden">
            <p class="filelink"><a href="">Source file <span class="file"></span>
                at tag <span class="thistag"></span></a></p>
            <p class="difflink"><a href="">Changes between <span class="prevtag"></span>
                and <span class="thistag"></span></a></p>
        </nav>
    </div>
    <script>
        let examples = {% include examples.json %};
    </script>
    <script>
        "use strict";

        let codeRepo = "https://github.com/java-to-kotlin/code";

        function initialise() {
            let query = new URLSearchParams(document.location.search);
            let exampleId = query.get("ref") || "";
            let codeRef = examples[exampleId];

            if (codeRef !== null) {
                let showType = query.get("show");
                if (showType === "diff" && codeRef.previousVersion !== null) {
                    window.location = diffUrl(codeRef);
                } else if (showType === "file") {
                    window.location = fileUrl(codeRef);
                } else {
                    let input = document.getElementById("coderef");
                    input.value = exampleId;
                    generateLinks();
                }
            }
        }

        function update(selector, block) {
            document.querySelectorAll(selector).forEach(e => block(e));
        }

        function generateLinks() {
            let input = document.getElementById("coderef");
            let exampleId = input.value;
            let codeRef = examples[exampleId];

            if (codeRef !== null) {
                update(".results", e => {
                    e.style.visibility = "visible";
                });
                update(".results .filelink a", e => {
                    e.href = fileUrl(codeRef);
                });
                update(".results .thistag", e => {
                    e.textContent = codeRef.version;
                });
                update(".results .file", e => {
                    e.textContent = codeRef.file
                });

                if (codeRef.previousVersion !== null) {
                    update(".results .difflink a", e => {
                        e.href = diffUrl(codeRef);
                    });
                    update(".results .prevtag", e => {
                        e.textContent = codeRef.previousVersion;
                    })
                    update(".results .difflink", e => {
                        e.style.visibility = "visible"
                    });
                } else {
                    update(".results .difflink", e => {
                        e.style.visibility = "hidden"
                    });
                }

                let search = new URLSearchParams();
                search.set("ref", exampleId);
                window.history.replaceState(null, null, "?" + search.toString());

            } else {
                console.log("no example: " + exampleId);

                update(".results", e => {
                    e.style.visibility = "hidden";
                });
                update(".results .difflink", e => {
                    e.style.visibility = null;
                });

                window.history.replaceState(null, null, "?");
            }
        }

        function diffUrl(codeRef) {
            return `${codeRepo}/compare/${codeRef.previousVersion}..${codeRef.version}?diff=split`;
        }

        function fileUrl(codeRef) {
            return `${codeRepo}/blob/${codeRef.version}/${codeRef.path}`
        }

        initialise();
    </script>
</section>
